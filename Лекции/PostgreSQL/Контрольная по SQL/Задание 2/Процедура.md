Продемонстрируем использование процедуры для реализации миграции населения между планетами. Для этого создадим демонстрационную таблицу и заполним ее следующим образом:

```sql
create table planets  -- создаем таблицу
(id int generated by default as identity, -- генерируется по умолчанию как идентификатор
name varchar(20) not null,
population dec(15,2) not null,
primary key(id));
-- Добавляем записи с балансом клиентов
insert into planets(name, population) values('Некромунда', 10000); 
insert into planets(name, population) values('Терра', 10000);
```

Далее создадим процедуру для перевода:

```sql
create or replace procedure transfer -- создаем процедуру перевода
(
in sender int, -- явное указание типа параметра
receiver int, 
amount dec
)
language plpgsql as
$$
begin
update planets 
set population = population - amount -- вычитание суммы со счета отправителя
where id = sender;
update planets 
set population = population + amount -- добавление суммы на счет получателя
where id = receiver;
commit; -- подтверждение транзакции
end;
$$;
```

Выполним перевод со счета (id=1) на счет (id=2) с помощью процедуры и продемонстрируем изменения значений:

```sql
select *
from planets;
call transfer(1,2,1000);
select *
from planets;
```

Результат:

![[Pasted image 20241003160553.png]]
