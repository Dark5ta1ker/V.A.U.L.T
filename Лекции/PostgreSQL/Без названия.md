## Задание № 1

Разработать скрипт создания и заполнения БД. Реализовать для БД 5-ть различных запросов. В 2-х и более запросах должны быть задействованы все таблицы БД. Продемонстрировать работу сформированных скриптов.

Ход выполнения

Для демонстрации работы скриптов использован on-line сервис PostgreSQL [https://onecompiler.com/postgresql](https://onecompiler.com/postgresql).

Формируем скрипт создания и заполнения БД:

```PostgreSQL
--Тип планеты
create table planet_type (
id integer not null, --Уникальный ключ
planettype varchar(40),
primary key (id));
--Список планет
create table planet (
id integer not null,
id_planet_type integer not null, --Связь с типом планет
planet_name varchar(40),
planet_system varchar(40),
population_mlns varchar(40),
communication varchar(4),
loyalty varchar(40),
primary key (id),
foreign key (id_planet_type) references planet_type (id));
--Климат
create table climat (
id integer not null,
climat_is varchar(40),
primary key (id));
--Таблица для связи таблиц
create table planet_climat (
id_planet integer not null, --Связь с таблицей планет
id_climat integer not null, --Связь с таблицей климата
primary key (id_climat, id_planet), --Уникальный составной ключ из двух таблиц
foreign key (id_planet) references planet(id), --Определение связи с таблицей планет
foreign key (id_climat) references climat(id)); --Опрределение связи с таблицей климата
--Добавляем записи в таблицу Тип планеты
insert into planet_type (id, planettype) values (1, 'Мир-улей');
insert into planet_type values (2, 'Мир-кузница');
insert into planet_type values (3, 'Мир-ферма');
insert into planet_type values (4, 'Мир-крепость');
insert into planet_type values (5, 'Мир Смерти');
--Добавляем записи в таблицу Планет
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (1, 2, 'Абхайлюнг', 'Абхайлюнг', '0', 'Нет',
'Хаос');
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (2, 2, 'Аккатран', 'Аккатран', '50000', 'Есть',
'Империя (Адептус Механикус)');
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (3, 3, 'Акридж', 'Акридж', '300', 'Есть',
'Империя (Феодалы)');
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (4, 4, 'Кадия', 'Кадия', '0', 'Нет',
'Хаос');
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (5, 2, 'Чаеро', 'Агрипина', '1', 'Есть',
'Империя (Астра милитарум)');
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (6, 1, 'Некромунда', 'Некромунда', '100000', 'Есть',
'Империя (Феодалы)');
insert into planet (id, id_planet_type, planet_name,
planet_system, population_mlns, communication, loyalty)
values (7, 5, 'Криг', 'Неизвестно', '1000', 'Есть',
'Империя (Астра милитарум)');
--Государственная принадлежность
insert into climat values (1, 'Жаркий');
insert into climat values (2, 'Теплый');
insert into climat values (3, 'Умеренный');
insert into climat values (4, 'Холодный');
insert into climat values (5, 'Влажный');
insert into climat values (6, 'Средней влажности');
insert into climat values (7, 'Засушливый');
insert into climat values (8, 'Безжизненна');
insert into climat values (9, 'Жизнь дружелюбна');
insert into climat values (10, 'Жизнь враждебна');
--Привязываем Планету к Климату
--Абхайлюнг
insert into planet_climat values (1, 1);
insert into planet_climat values (1, 7);
insert into planet_climat values (1, 8);
--Аккатран
insert into planet_climat values (2, 4);
insert into planet_climat values (2, 7);
insert into planet_climat values (2, 10);
--Акридж
insert into planet_climat values (3, 3);
insert into planet_climat values (3, 6);
insert into planet_climat values (3, 9);
--Кадия
insert into planet_climat values (4, 1);
insert into planet_climat values (4, 7);
insert into planet_climat values (4, 8);
--Чаеро
insert into planet_climat values (5, 2);
insert into planet_climat values (5, 6);
insert into planet_climat values (5, 8);
--Некромунда
insert into planet_climat values (6, 1);
insert into planet_climat values (6, 7);
insert into planet_climat values (6, 10);
--Криг
insert into planet_climat values (7, 1);
insert into planet_climat values (7, 5);
insert into planet_climat values (7, 8);
```

### Запрос №1

Вывести название планеты из БД у которой максимальное население:

```PostgreSQL
select p.planet_name, p.population_mlns
from planet p
order by p.population_mlns desc limit 1;
```

Результат:

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXd1Op4Z1CJ-QKtr6sorRwkWXt9wwoOdJyk61GbMIAsaWByxAw5NNQgn0mtKb_-QhBLQDa4ntc4gtQ1XgPj46yBwwkpJ1OD1uKH-8V-pbfTDwgnHFXTLOwDjxtnXeejvcMHvxmjqiYKOlge6RjEMcwX3UbE7?key=Nc1AqDoWqBj3garmMaQpUA)

Пример работает некорректно, так как скрипт сортирует численность населения по первой цифре, не учитывая количество нулей. Все дело в типе переменной p.population_mlns - varchar, из-за которого алгоритм не может нормально произвести сортировку. Изменим тип переменной на int и повторим запрос:

```PostgreSQL
select p.planet_name, p.population_mlns
from planet p
order by p.population_mlns desc limit 1;
```
  
Результат:

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXc8VMS148m8zdzxaGERUIAc322g6JvKimuSdNhlxE_uzHf-9Si0LSMDgG3ZcbiCz_2Wt9hnbnizsvRJVnOK9f9rYIqbv69S8dAgYJzlBFXPFfN-46u0HUo-oUtkuWa7NurJc7I6zQFlFsnT6kIP4n2UL8lY?key=Nc1AqDoWqBj3garmMaQpUA)

Приведенный пример будет работать некорректно если есть планеты, у которых не указано население.
### Запрос №2

Вывести название планеты из БД, с учетом возможности пустых значений для населения планет:

```PostgreSQL
select p.planet_name, p.population_mlns
from planet p
where p.population_mlns = (select max(p.population_mlns) from planet p);
```

Результат:

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXc8VMS148m8zdzxaGERUIAc322g6JvKimuSdNhlxE_uzHf-9Si0LSMDgG3ZcbiCz_2Wt9hnbnizsvRJVnOK9f9rYIqbv69S8dAgYJzlBFXPFfN-46u0HUo-oUtkuWa7NurJc7I6zQFlFsnT6kIP4n2UL8lY?key=Nc1AqDoWqBj3garmMaQpUA)

